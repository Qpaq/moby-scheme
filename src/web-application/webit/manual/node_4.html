<html><head><title>WebIt! Reference Manual</title><meta name="generator" content="WebIt!" /><meta name="robots" content="index,follow" /><link rel="stylesheet" href="./default.css" type="text/css" /></head><body><p /><div align="right" class="navigation">[Go to <a href="./index.html">first</a>, <a href="./node_3.html">previous</a>, <a href="./node_5.html">next</a> page; <a href="./index.html#toc_start">contents</a>]</div><div><a name="container_224" /><h1><a href="./index.html#toc_container_224">3&nbsp;XML Transformation</a></h1><div><a name="container_225" /><h2><a href="./index.html#toc_container_225">3.1&nbsp;<code class="scheme"><span class="keyword">stylesheet</span></code></a></h2><p><em>syntax</em></p><p>A stylesheet is a set of rules for transformation of XML. The stylesheet syntax allows one to intermix a sequence of xml-micro's, xml-macro's, and top-level Scheme expressions.</p><p>The grammar for <code class="scheme"><span class="keyword">stylesheet</span></code> is given below:</p><pre>stylesheet-form ::= (stylesheet body-item*)

body-item ::= xml-micro-form
            | xml-macro-form
            | top-level-sceheme-expression
</pre><p>A stylesheet form evaluates to a stylesheet object.</p><p>The semantics of top-level definitions within a stylesheet is identical to that of PLT Scheme's units.</p></div><div><a name="container_226" /><h2><a href="./index.html#toc_container_226">3.2&nbsp;<code class="scheme"><span class="keyword">xml-micro</span></code></a></h2><p><em>syntax</em></p><p>An xml-micro performs a single transformation of its argument. The result of this transformation is not further "expanded".</p><p>The grammar for <code class="scheme"><span class="keyword">xml-micro</span></code> is:</p><pre>micro-form ::= (xml-micro trigger-tag
                 expression)

trigger-tag ::= element-tag
              | *text*
              | *data*</pre><p>The expression in an xml-micro must evaluate to a function of which takes an XML node as its argument, and (generally) returns a node or nodeset.</p></div><div><a name="container_227" /><h2><a href="./index.html#toc_container_227">3.3&nbsp;<code class="scheme"><span class="keyword">xml-macro</span></code></a></h2><p><em>syntax</em></p><p>An xml-macro performs a transformation of its argument; the result of this transformation further "expanded" until no further transformations are possible.</p><p>The grammar for <code class="scheme"><span class="keyword">xml-macro</span></code> is:</p><pre>macro-form ::= (xml-macro trigger-tag
                 expression)

trigger-tag ::= element-tag
              | *text*
              | *data*</pre><p>The expression in an xml-macro must evaluate to a function of which takes an XML node as its argument, and returns a node or nodeset.</p><p>No further transformations of a node are possible when no more xml-micros or xml-macros are triggered by that node under the stylesheet being applied.</p></div><div><a name="container_228" /><h2><a href="./index.html#toc_container_228">3.4&nbsp;<code class="scheme"><span class="variable">stylesheet-&gt;expander</span></code></a></h2><p><em>function</em></p><pre>stylesheet-&gt;expander :: stylesheet -&gt; (function node -&gt; node))</pre><p>This function converts a stylesheet to an expander function. The return-result may be applied to an XML node to apply the stylesheet's transformations.</p></div><div><a name="container_229" /><h2><a href="./index.html#toc_container_229">3.5&nbsp;<code class="scheme"><span class="keyword">compound-stylesheet</span></code></a></h2><p><em>syntax</em></p><p>This form is used to combine multiple stylesheets. The result of evaluating a compound-stylesheet is a new stylesheet object.</p><p>The grammar for a <code class="scheme"><span class="keyword">compound-stylesheet</span></code> is given below:</p><pre>compound-ss-form ::= (compound-stylesheet expression+)</pre><p>Each expression must evaluate to a stylesheet object.</p></div><div><a name="container_230" /><h2><a href="./index.html#toc_container_230">3.6&nbsp;Example</a></h2><p>The example below is a complete working stylesheet which translates a collection of poetry into HTML. The 'micro' for the poem element formats a poem into HTML. The 'macro' for the book element creates a skeletal HTML document, with a new contents element which contains both a table of contents element and the poems to be formatted. The 'micro' for the contents element formats the table of contents and uses <code class="scheme"><span class="variable">xml-expand</span></code> to invoke the expander on each of the poems.</p><p><code class="scheme"><span class="variable">poetry-&gt;html</span></code> is bound to the result of applying <code class="scheme"><span class="variable">stylesheet-&gt;expander</span></code> to the stylesheet, producing a function which takes a single argument: the poetry book element.</p><div class="figure"><pre class="scheme">(<span class="keyword">define</span> <span class="variable">poetry-&gt;html</span>
  (<span class="variable">stylesheet-&gt;expander</span>
   (<span class="keyword">stylesheet</span>
     
     (<span class="keyword">define-element</span> <span class="variable">toc</span>)
     (<span class="keyword">define-element</span> <span class="variable">contents</span>)
     
     (<span class="keyword">xml-micro</span> <span class="variable">poem</span>
       (<span class="keyword">lambda</span> (<span class="variable">x</span>)
         (<span class="keyword">xml-match</span> <span class="variable">x</span>
           [(<span class="variable">poem</span> <span class="variable">title:</span> <span class="keyword">,</span><span class="variable">t</span> <span class="variable">poet:</span> <span class="keyword">,</span><span class="variable">a</span> <span class="variable">tag:</span> <span class="keyword">,</span><span class="variable">m</span>
                  (<span class="variable">stanza</span> (<span class="variable">line</span> <span class="keyword">,</span><span class="variable">l1</span>) (<span class="variable">line</span> <span class="keyword">,</span><span class="variable">l</span>) <span class="variable">...</span>) <span class="variable">...</span>)
            (<span class="variable">h4:div</span> (<span class="variable">h4:p</span>) (<span class="variable">h4:a</span> <span class="variable">h4:name:</span> <span class="variable">m</span>) (<span class="variable">h4:strong</span> <span class="variable">t</span>) (<span class="variable">h4:br</span>) (<span class="variable">h4:em</span> <span class="variable">a</span>)
                    (<span class="builtin">list</span> (<span class="variable">h4:p</span>) <span class="variable">l1</span> (<span class="builtin">list</span> (<span class="variable">h4:br</span>) <span class="variable">l</span>) <span class="variable">...</span>) <span class="variable">...</span>)])))
     
     (<span class="keyword">xml-micro</span> <span class="variable">contents</span>
       (<span class="keyword">lambda</span> (<span class="variable">x</span>)
         (<span class="keyword">xml-match</span> <span class="variable">x</span>
           [(<span class="variable">contents</span> (<span class="variable">toc</span> (<span class="variable">poem</span> <span class="variable">title:</span> <span class="keyword">,</span><span class="variable">t</span> <span class="variable">poet:</span> <span class="keyword">,</span><span class="variable">a</span> <span class="variable">tag:</span> <span class="keyword">,</span><span class="variable">m</span> . <span class="keyword">,</span><span class="variable">rest</span>) <span class="variable">...</span>) <span class="keyword">,</span><span class="variable">p*</span> <span class="variable">...</span>)
            (<span class="variable">h4:div</span> (<span class="variable">h4:p</span>) <span class="selfeval">"Table of Contents:"</span>
                    (<span class="variable">h4:ul</span>
                     (<span class="variable">h4:li</span> (<span class="variable">h4:a</span> <span class="variable">h4:href:</span> (<span class="builtin">string-append</span> <span class="selfeval">"#"</span> <span class="variable">m</span>) <span class="variable">t</span>)) <span class="variable">...</span>)
                    (<span class="variable">xml-expand</span> <span class="variable">p*</span>) <span class="variable">...</span>)])))
     
     (<span class="keyword">xml-macro</span> <span class="variable">book</span>
       (<span class="keyword">lambda</span> (<span class="variable">x</span>)
         (<span class="keyword">xml-match</span> <span class="variable">x</span>
           [(<span class="variable">book</span> <span class="variable">title:</span> <span class="keyword">,</span><span class="variable">bt</span> <span class="keyword">,</span><span class="variable">p*</span> <span class="variable">...</span>)
            (<span class="variable">h4:html</span>
             (<span class="variable">h4:head</span> (<span class="variable">h4:title</span> <span class="variable">bt</span>))
             (<span class="variable">h4:body</span>
              (<span class="variable">h4:h1</span> <span class="variable">bt</span>)
              (<span class="variable">contents</span> (<span class="variable">toc</span> <span class="variable">p*</span> <span class="variable">...</span>)
                        <span class="variable">p*</span> <span class="variable">...</span>)))])))
     
     )))
</pre></div></div></div><p style="margin-top:24pt;">&nbsp;</p><p /><div align="right" class="navigation">[Go to <a href="./index.html">first</a>, <a href="./node_3.html">previous</a>, <a href="./node_5.html">next</a> page; <a href="./index.html#toc_start">contents</a>]</div><p>&nbsp;</p><div class="collophon" align="right">Last modified: Sunday, April 24th, 2005 2:52:27pm<br />HTML generated using <a href="http://celtic.benderweb.net/webit/">WebIt!</a>.</div></body></html>